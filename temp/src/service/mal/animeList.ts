import fetch, {Headers} from "node-fetch"

// const baseUrl = ''
// const apiVer = 'v2/'
// const firstEP = 'anime/10357?fields=rank,mean,alternative_titles'
// let username = 'nugen_exe'
// username = 'therealmccree'
// username = 'bambibutt'
// const usersEP = `users/${username}/animelist?`

// import info from '../appProps.json'
import appProps from  'appProps.json' assert { type: "json" };
import { AnimeListNode } from "src/model/mal/animeList.js";

export class AnimeList {
	test: string = ''
	queryParams: any = appProps.mal.commonMALQueryParams

	constructor(queryParams? : any) {
		if (queryParams !== null) {
			console.log('HELLo')
			this.queryParams = queryParams
		}
	}

	route(username: string) {
		return `users/${username}/animelist`
	}

	async getAnimeList(username: string) {
		const queryParams = appProps.mal.commonMALQueryParams
		let url = `${ appProps.mal.baseUrl }${ this.route(username) }?${ '' + new URLSearchParams(queryParams) }`
		const headers = new Headers(appProps.mal.malHeaders)
	
		let animeList: AnimeListNode[] = []
		
		let count: number = 0
		do {
			let response = await fetch(url, { headers })
			let responseJSON: any = await response.json()
			animeList = animeList.concat(responseJSON.data)
	
			url = responseJSON.paging.next
			count++
			// if(count > 2) break
		} while(url !== undefined)
	
		return animeList
	}


}